<!DOCTYPE html><html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-strategies/per-space-version" data-theme="light" data-rh="lang,dir,class"><head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title>Per-Space Version Strategy | Replicache Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://doc.replicache.dev/strategies/per-space-version"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Per-Space Version Strategy | Replicache Docs"><meta data-rh="true" name="description" content="The Per-Space Version Strategy is the same as the The Global Version Strategy except it has more than one space."><meta data-rh="true" property="og:description" content="The Per-Space Version Strategy is the same as the The Global Version Strategy except it has more than one space."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://doc.replicache.dev/strategies/per-space-version"><link data-rh="true" rel="alternate" href="https://doc.replicache.dev/strategies/per-space-version" hreflang="en"><link data-rh="true" rel="alternate" href="https://doc.replicache.dev/strategies/per-space-version" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://Y3T1SV2WRD-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Replicache Docs" href="/opensearch.xml">
<script type="text/javascript" async="" src="https://www.googletagmanager.com/gtag/js?id=G-GQBKRVPR1B&amp;l=dataLayer&amp;cx=c&amp;gtm=45He4cc1v865895793za200"></script><script async="" src="https://www.googletagmanager.com/gtm.js?id=GTM-PTN768T"></script><script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-PTN768T",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>

<script src="/js/redirects.js"></script><link rel="stylesheet" href="/assets/css/styles.9185dd9b.css">
<link rel="preload" href="/assets/js/runtime~main.ca11e309.js" as="script">
<link rel="preload" href="/assets/js/main.6abc1f11.js" as="script">
<meta name="viewport" content="width=device-width, initial-scale=1.0" data-rh="true"><link rel="prefetch" href="/assets/js/1be78505.2ff0b744.js"><link rel="prefetch" href="/assets/js/a4df073c.e9e4229e.js"><link rel="prefetch" href="/assets/js/935f2afb.dec4d439.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/59a64286.400d29cd.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/0f3acd10.1deb4875.js"><link rel="prefetch" href="/assets/js/1be78505.2ff0b744.js"><link rel="prefetch" href="/assets/js/a4df073c.e9e4229e.js"><link rel="prefetch" href="/assets/js/935f2afb.dec4d439.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/59a64286.400d29cd.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/4cb8c6ce.419915da.js"><link rel="prefetch" href="/assets/js/1be78505.2ff0b744.js"><link rel="prefetch" href="/assets/js/a4df073c.e9e4229e.js"><link rel="prefetch" href="/assets/js/935f2afb.dec4d439.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/59a64286.400d29cd.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/3afd88c8.0a25afb5.js"><link rel="prefetch" href="/assets/js/1be78505.2ff0b744.js"><link rel="prefetch" href="/assets/js/a4df073c.e9e4229e.js"><link rel="prefetch" href="/assets/js/935f2afb.dec4d439.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/59a64286.400d29cd.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/5f2ffadc.666f1eaf.js"><link rel="prefetch" href="/assets/js/1be78505.2ff0b744.js"><link rel="prefetch" href="/assets/js/a4df073c.e9e4229e.js"><link rel="prefetch" href="/assets/js/935f2afb.dec4d439.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/59a64286.400d29cd.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/cc85606c.18b7c252.js"><link rel="prefetch" href="/assets/js/1be78505.2ff0b744.js"><link rel="prefetch" href="/assets/js/a4df073c.e9e4229e.js"><link rel="prefetch" href="/assets/js/935f2afb.dec4d439.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/59a64286.400d29cd.js"><link rel="prefetch" href="/assets/js/1be78505.2ff0b744.js"><link rel="prefetch" href="/assets/js/a4df073c.e9e4229e.js"><link rel="prefetch" href="/assets/js/935f2afb.dec4d439.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/59a64286.400d29cd.js"><link rel="prefetch" href="/assets/js/1be78505.2ff0b744.js"><link rel="prefetch" href="/assets/js/a4df073c.e9e4229e.js"><link rel="prefetch" href="/assets/js/935f2afb.dec4d439.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/59a64286.400d29cd.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/3349748a.292d8b30.js"><link rel="prefetch" href="/assets/js/1be78505.2ff0b744.js"><link rel="prefetch" href="/assets/js/a4df073c.e9e4229e.js"><link rel="prefetch" href="/assets/js/935f2afb.dec4d439.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/59a64286.400d29cd.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/3e42dbf6.96d57c57.js"><link rel="prefetch" href="/assets/js/1be78505.2ff0b744.js"><link rel="prefetch" href="/assets/js/a4df073c.e9e4229e.js"><link rel="prefetch" href="/assets/js/935f2afb.dec4d439.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/59a64286.400d29cd.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/bbdd3825.dd815daa.js"><link rel="prefetch" href="/assets/js/1be78505.2ff0b744.js"><link rel="prefetch" href="/assets/js/a4df073c.e9e4229e.js"><link rel="prefetch" href="/assets/js/935f2afb.dec4d439.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/59a64286.400d29cd.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/5e8c322a.2cb272b4.js"><link rel="prefetch" href="/assets/js/1be78505.2ff0b744.js"><link rel="prefetch" href="/assets/js/a4df073c.e9e4229e.js"><link rel="prefetch" href="/assets/js/935f2afb.dec4d439.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/59a64286.400d29cd.js"><link rel="prefetch" href="/assets/js/17896441.b90c7a0e.js"><link rel="prefetch" href="/assets/js/481c9a43.53b9451c.js"></head>
<body class="navigation-with-keyboard" data-rh="class" style="overflow: visible;">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/replicache.svg" alt="Shiny Replicache Logo" class="themedImage_ToTc themedImage--light_HNdA"></div><b class="navbar__title text--truncate">Replicache Documentation</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/rocicorp/replicache" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a href="#" class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false">Hello, Replicache</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a href="#" class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false">Examples</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a href="#" class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false">Build Your Own Backend</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a href="#" class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true">Backend Strategies</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/strategies/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/strategies/reset">Reset Strategy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/strategies/global-version">Global Version Strategy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/strategies/per-space-version">Per-Space Version Strategy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/strategies/row-version">Row Version Strategy</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a href="#" class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false">Understand Replicache</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a href="#" class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a href="#" class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false">How To</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://replicache.notion.site/Replicache-Releases-f86ffef7f72f46ca9b597d5081e05b88" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK">Releases<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Backend Strategies</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Per-Space Version Strategy</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>🛸 Per-Space Version Strategy</h1><p>The Per-Space Version Strategy is the same as the <a href="/strategies/global-version">The Global Version Strategy</a> except it has more than one space.</p><p>This increases throughput of the server. Instead of approximately 50 pushes per second across your entire server, you can get 50 pushes per space.</p><p>A common example of how people partition by space is along organizational boundaries in a SaaS application. Each customer org would be its own space and you'd thereby get 50 pushes per second per organization.</p><p>The tradeoffs to keep in mind is that you lose consistency guarantees across spaces. Replicache mutations are atomic: you can move data within a space, rename, copy, etc., and you have a guarantee that the entire change happens or none of it does. But this guarantee does not apply across spaces.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Example</div><div class="admonitionContent_S0QG"><p>Imagine moving data from one space to another. Because there is no transactional guarantees across spaces, during the move, the user might see the data exist in both spaces, or neither.</p><p>While this might just seem like a minor UI annoyance, keep in mind that it means that if you have IDs that refer to data across spaces, there is no guarantee that the data actually exists at the moment you render. You'll have to defensively guard against invalid pointers into other spaces.</p></div></div><p>This is why partitioning makes most sense at very high-level boundaries, like organizations, so that it will be uncommon in your application to want to have data from two spaces interact.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="schema">Schema<a href="#schema" class="hash-link" aria-label="Direct link to Schema" title="Direct link to Schema">​</a></h2><p>The schema generalizes the schema from the <a href="/strategies/reset">Global Version Strategy</a>:</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color: #bfc7d5; --prism-background-color: #292d3e;"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token keyword" style="font-style: italic;">type</span><span class="token plain"> </span><span class="token class-name" style="color: rgb(255, 203, 107);">ReplicacheSpace</span><span class="token plain"> </span><span class="token operator" style="color: rgb(137, 221, 255);">=</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(199, 146, 234);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  id</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> </span><span class="token builtin" style="color: rgb(130, 170, 255);">string</span><span class="token punctuation" style="color: rgb(199, 146, 234);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  </span><span class="token comment" style="color: rgb(105, 112, 152); font-style: italic;">// Same as Global Version Strategy.</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  version</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> </span><span class="token builtin" style="color: rgb(130, 170, 255);">number</span><span class="token punctuation" style="color: rgb(199, 146, 234);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain"></span><span class="token punctuation" style="color: rgb(199, 146, 234);">}</span><span class="token punctuation" style="color: rgb(199, 146, 234);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain"></span><span class="token keyword" style="font-style: italic;">type</span><span class="token plain"> </span><span class="token class-name" style="color: rgb(255, 203, 107);">ReplicacheClientGroup</span><span class="token plain"> </span><span class="token operator" style="color: rgb(137, 221, 255);">=</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(199, 146, 234);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  </span><span class="token comment" style="color: rgb(105, 112, 152); font-style: italic;">// Same as Global Version Strategy.</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  id</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> </span><span class="token builtin" style="color: rgb(130, 170, 255);">string</span><span class="token punctuation" style="color: rgb(199, 146, 234);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  userID</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> </span><span class="token builtin" style="color: rgb(130, 170, 255);">any</span><span class="token punctuation" style="color: rgb(199, 146, 234);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  spaceID</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> </span><span class="token builtin" style="color: rgb(130, 170, 255);">string</span><span class="token punctuation" style="color: rgb(199, 146, 234);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain"></span><span class="token punctuation" style="color: rgb(199, 146, 234);">}</span><span class="token punctuation" style="color: rgb(199, 146, 234);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain"></span><span class="token keyword" style="font-style: italic;">type</span><span class="token plain"> </span><span class="token class-name" style="color: rgb(255, 203, 107);">ReplicacheClient</span><span class="token plain"> </span><span class="token operator" style="color: rgb(137, 221, 255);">=</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(199, 146, 234);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  </span><span class="token comment" style="color: rgb(105, 112, 152); font-style: italic;">// Same as Global Version Strategy.</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  id</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> </span><span class="token builtin" style="color: rgb(130, 170, 255);">string</span><span class="token punctuation" style="color: rgb(199, 146, 234);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  clientGroupID</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> </span><span class="token builtin" style="color: rgb(130, 170, 255);">string</span><span class="token punctuation" style="color: rgb(199, 146, 234);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  lastMutationID</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> </span><span class="token builtin" style="color: rgb(130, 170, 255);">number</span><span class="token punctuation" style="color: rgb(199, 146, 234);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  lastModifiedVersion</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> </span><span class="token builtin" style="color: rgb(130, 170, 255);">number</span><span class="token punctuation" style="color: rgb(199, 146, 234);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain"></span><span class="token punctuation" style="color: rgb(199, 146, 234);">}</span><span class="token punctuation" style="color: rgb(199, 146, 234);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain"></span><span class="token comment" style="color: rgb(105, 112, 152); font-style: italic;">// Each of your domain entities will have three additional fields.</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain"></span><span class="token keyword" style="font-style: italic;">type</span><span class="token plain"> </span><span class="token class-name" style="color: rgb(255, 203, 107);">Todo</span><span class="token plain"> </span><span class="token operator" style="color: rgb(137, 221, 255);">=</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(199, 146, 234);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  </span><span class="token comment" style="color: rgb(105, 112, 152); font-style: italic;">// ... fields needed for your application (id, title, complete, etc)</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  </span><span class="token comment" style="color: rgb(105, 112, 152); font-style: italic;">// Same as Global Version Strategy.</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  lastModifiedVersion</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> </span><span class="token builtin" style="color: rgb(130, 170, 255);">number</span><span class="token punctuation" style="color: rgb(199, 146, 234);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  deleted</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> </span><span class="token builtin" style="color: rgb(130, 170, 255);">boolean</span><span class="token punctuation" style="color: rgb(199, 146, 234);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  spaceID</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> </span><span class="token builtin" style="color: rgb(130, 170, 255);">string</span><span class="token punctuation" style="color: rgb(199, 146, 234);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain"></span><span class="token punctuation" style="color: rgb(199, 146, 234);">}</span><span class="token punctuation" style="color: rgb(199, 146, 234);">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="push">Push<a href="#push" class="hash-link" aria-label="Direct link to Push" title="Direct link to Push">​</a></h2><p>The push handler should receive the <code>spaceID</code> being operated on as an HTTP parameter. The logic is otherwise almost identical to the Global Version Strategy, with minor changes to deal with spaces. The changes from the Global Version Strategy are marked below <strong>in bold</strong>.</p><p>Replicache sends a <a href="/reference/server-push#http-request-body"><code>PushRequest</code></a> to the push endpoint. For each mutation described in the request body, the push endpoint should:</p><ol><li><code>let errorMode = false</code></li><li>Begin transaction</li><li><strong>Read the <code>ReplicacheClientGroup</code> for <code>body.clientGroupID</code> from the database, or default to:</strong></li></ol><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color: #bfc7d5; --prism-background-color: #292d3e;"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token punctuation" style="color: rgb(199, 146, 234);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  id</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> body.clientGroupID</span><span class="token punctuation" style="color: rgb(199, 146, 234);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  spaceID</span><span class="token punctuation" style="color: rgb(199, 146, 234);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  userID</span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain"></span><span class="token punctuation" style="color: rgb(199, 146, 234);">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>Verify the requesting user owns the specified client group.</li><li><strong>Verify the specified client group is part of the requesting space.</strong></li><li>Read the <code>ReplicacheClient</code> for <code>mutation.clientID</code> or default to:</li></ol><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color: #bfc7d5; --prism-background-color: #292d3e;"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token punctuation" style="color: rgb(199, 146, 234);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  id</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> mutation.clientID</span><span class="token punctuation" style="color: rgb(199, 146, 234);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  clientGroupID</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> body.clientGroupID</span><span class="token punctuation" style="color: rgb(199, 146, 234);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  lastMutationID</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> </span><span class="token number" style="color: rgb(247, 140, 108);">0</span><span class="token punctuation" style="color: rgb(199, 146, 234);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  lastModifiedVersion</span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain"></span><span class="token punctuation" style="color: rgb(199, 146, 234);">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="7"><li>Verify the requesting client group owns the requested client.</li><li><code>let nextMutationID = client.lastMutationID + 1</code></li><li><strong>Read the <code>ReplicacheSpace</code> for <code>request.params.spaceID</code></strong></li><li><code>let nextVersion = replicacheSpace.version + 1</code></li><li>Rollback transaction and skip this mutation if already processed (<code>mutation.id &lt; nextMutationID</code>)</li><li>Rollback transaction and error if mutation from the future (<code>mutation.id &gt; nextMutationID</code>)</li><li>If <code>errorMode != true</code> then:<ol><li>Try to run business logic for mutation<ol><li>Set <code>lastModifiedVersion</code> for any modified rows to <code>nextVersion</code>.</li><li>Set <code>deleted = true</code> for any deleted entities.</li></ol></li><li>If error:<ol><li>Log error</li><li><code>set errorMode = true</code></li><li>Abort transaction</li><li>Repeat these steps at the beginning</li></ol></li></ol></li><li><strong>Write <code>ReplicacheSpace</code>:</strong></li></ol><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color: #bfc7d5; --prism-background-color: #292d3e;"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token punctuation" style="color: rgb(199, 146, 234);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  id</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> body.clientGroupID</span><span class="token punctuation" style="color: rgb(199, 146, 234);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  spaceID</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> request.params.spaceID</span><span class="token punctuation" style="color: rgb(199, 146, 234);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  version</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> nextVersion</span><span class="token punctuation" style="color: rgb(199, 146, 234);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain"></span><span class="token punctuation" style="color: rgb(199, 146, 234);">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="15"><li><strong>Write <code>ReplicacheClientGroup</code>:</strong></li></ol><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color: #bfc7d5; --prism-background-color: #292d3e;"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token punctuation" style="color: rgb(199, 146, 234);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  id</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> body.clientGroupID</span><span class="token punctuation" style="color: rgb(199, 146, 234);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  userID</span><span class="token punctuation" style="color: rgb(199, 146, 234);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  spaceId</span><span class="token punctuation" style="color: rgb(199, 146, 234);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain"></span><span class="token punctuation" style="color: rgb(199, 146, 234);">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="16"><li>Write <code>ReplicacheClient</code>:</li></ol><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color: #bfc7d5; --prism-background-color: #292d3e;"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token punctuation" style="color: rgb(199, 146, 234);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  id</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> mutation.clientID</span><span class="token punctuation" style="color: rgb(199, 146, 234);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  clientGroupID</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> body.clientGroupID</span><span class="token punctuation" style="color: rgb(199, 146, 234);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  lastMutationID</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> nextMutationID</span><span class="token punctuation" style="color: rgb(199, 146, 234);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  lastModifiedVersion</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> nextVersion</span><span class="token punctuation" style="color: rgb(199, 146, 234);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain"></span><span class="token punctuation" style="color: rgb(199, 146, 234);">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="17"><li>Commit transaction</li></ol><p>After the loop is complete, poke clients to cause them to pull.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pull">Pull<a href="#pull" class="hash-link" aria-label="Direct link to Pull" title="Direct link to Pull">​</a></h2><p>The pull handler is the same as in the Global Version Strategy, but with mionr changes to support multiple spaces. Changes from the Global Version Strategy are <strong>marked in bold</strong>.</p><p>Replicache sends a <a href="/reference/server-pull#http-request-body"><code>PullRequest</code></a> to the pull endpoint. The pull handler should also receive the <code>spaceID</code> being operated on as an HTTP parameter. The endpoint should:</p><ol><li>Begin transaction</li><li><code>let prevVersion = body.cookie ?? 0</code></li><li>Read the <code>ReplicacheClientGroup</code> for <code>body.clientGroupID</code> from the database, or default to:</li></ol><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color: #bfc7d5; --prism-background-color: #292d3e;"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token punctuation" style="color: rgb(199, 146, 234);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  id</span><span class="token operator" style="color: rgb(137, 221, 255);">:</span><span class="token plain"> body.clientGroupID</span><span class="token punctuation" style="color: rgb(199, 146, 234);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain">  userID</span><br></span><span class="token-line" style="color: rgb(191, 199, 213);"><span class="token plain"></span><span class="token punctuation" style="color: rgb(199, 146, 234);">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>Verify the requesting client group owns the requested client.</li><li>Verify the client group is part of the requesed space.</li><li><strong>Read the <code>ReplicacheSpace</code> entity for <code>request.params.spaceID</code></strong></li><li><strong>Read all domain entities from the database that have <code>spaceID == request.params.spaceID AND lastModifiedVersion &gt; prevVersion</code></strong></li><li>Read all <code>ReplicacheClient</code> records for the requested client group that have <code>lastModifiedVersion &gt; prevVersion</code>.</li><li>Create a <code>PullResponse</code> with:<ol><li><code>cookie</code> set to <code>space.version</code></li><li><code>lastMutationIDChanges</code> set to the <code>lastMutationID</code> for every client that has changed.</li><li><code>patch</code> set to:<ol><li><code>op:del</code> for all domain entities that have changed and are deleted</li><li><code>op:put</code> for all domain entities that have changed and aren't deleted</li></ol></li></ol></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h2><p><a href="https://github.com/rocicorp/todo-wc" target="_blank" rel="noopener noreferrer">Todo-WC</a> is a simple example of per-space versioning. <a href="/examples/repliear">Repliear</a> is a more involved example. Note that both examples also uses <a href="/howto/share-mutators">Shared Mutators</a> and <a href="#early-exit-batch-size">batch the mutations</a> into a single transaction. So the logic is a little different than described above, but equivalent.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="challenges">Challenges<a href="#challenges" class="hash-link" aria-label="Direct link to Challenges" title="Direct link to Challenges">​</a></h2><ul><li>Like the Global Version strategy, soft deletes can be annoying.</li><li>Also like the Global Version strategy, it is difficult to implement features like read authentication and partial sync.</li><li>It can be hard in some applications to find a way to partition spaces naturally.</li><li>50 pushes per second per space can still be insufficient for some applications.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="variations">Variations<a href="#variations" class="hash-link" aria-label="Direct link to Variations" title="Direct link to Variations">​</a></h2><p>The same variations available to <a href="/strategies/global-version#variations">The Global Version Strategy</a> apply here.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/rocicorp/replicache/tree/main/doc/docs/strategies/per-space-version.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/strategies/global-version"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Global Version Strategy</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/strategies/row-version"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Row Version Strategy</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#schema" class="table-of-contents__link toc-highlight">Schema</a></li><li><a href="#push" class="table-of-contents__link toc-highlight">Push</a></li><li><a href="#pull" class="table-of-contents__link toc-highlight">Pull</a></li><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li><li><a href="#challenges" class="table-of-contents__link toc-highlight">Challenges</a></li><li><a href="#variations" class="table-of-contents__link toc-highlight">Variations</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Connect</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:hello@replicache.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.replicache.dev/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/replicache" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Rocicorp LLC.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ca11e309.js"></script>
<script src="/assets/js/main.6abc1f11.js"></script>

</body></html>